# docker面试题

#### docker和虚拟机的区别

虚拟机： 我们传统的虚拟机需要模拟整台机器包括硬件，每台虚拟机都需要有自己的操作系统，虚拟机一旦被开启，预分配给他的资源将全部被占用。每一个虚拟机包括应用，必要的二进制和库，以及一个完整的用户操作系统。

Docker： 容器技术是和我们的宿主机共享硬件资源及操作系统可以实现资源的动态分配。 容器包含应用和其所有的依赖包，但是与其他容器共享内核。容器在宿主机操作系统中，在用户空间以分离的进程运行。

#### 什么是容器，为什么要使用容器

**容器（Container）** 是一种轻量级、可移植、封装的软件运行环境，它将应用程序及其所有依赖（如库、配置文件、环境变量等）打包在一起，使其能够在不同的计算环境中一致地运行。容器技术通常通过操作系统级虚拟化来实现，与传统的虚拟机不同，容器不需要额外的操作系统支持，而是共享宿主机的操作系统内核，这使得容器更加轻量、高效。

#### 守护式容器

#### docker是怎么实现他的隔离性的

```
1. Namespaces（命名空间）
Namespaces 是 Linux 内核提供的一种机制，用于将系统资源（如进程、网络、挂载点等）隔离到不同的命名空间中。每个容器都有自己的命名空间，因此它只能看到和访问它自己命名空间中的资源。常见的命名空间包括：

PID Namespace：隔离进程 ID，使得容器中的进程只能看到容器内部的进程，不会干扰或访问主机或其他容器的进程。
Network Namespace：隔离网络，使得容器可以拥有自己的网络接口、IP 地址、端口等，容器内的应用只能访问容器内部的网络，而不会影响主机或其他容器的网络。
Mount Namespace：隔离文件系统挂载点，容器内部的文件系统是独立的，容器可以拥有自己的挂载点和文件系统结构，避免干扰宿主机或其他容器的文件系统。
UTS Namespace：隔离主机名和域名，容器内可以设置自己的主机名，和宿主机或其他容器的主机名完全独立。
IPC Namespace：隔离进程间通信（IPC）资源，如共享内存、消息队列和信号量等，使得容器内的进程不会与宿主机或其他容器共享 IPC 资源。
User Namespace：允许容器内部的用户与宿主机用户具有不同的 UID 和 GID，进一步增强容器的安全性，使得容器内的用户没有宿主机上管理员权限（root）。
2. Control Groups (cgroups)
cgroups 是 Linux 内核的一个特性，用来限制、记录和隔离进程对资源的使用（如 CPU、内存、磁盘 I/O 等）。通过 cgroups，Docker 可以控制每个容器使用的资源量，避免某个容器占用过多资源而影响宿主机或其他容器的性能。例如，可以限制一个容器的最大内存使用量，超出时容器会被杀死或触发其他处理机制。

3. Filesystem (Union File System)
Docker 使用一种叫做 Union File System (UnionFS) 的技术来管理容器的文件系统。UnionFS 允许多个文件系统层叠在一起，每个层代表一个只读的镜像层。容器在运行时创建一个可写的层，这个层用于记录容器的修改（如文件的创建、修改、删除）。这样，每个容器都有自己独立的文件系统，避免了容器之间对文件系统的冲突。

Docker 支持多种 UnionFS 类型，如：

AUFS（Advanced Multi-layered Unification Filesystem）
OverlayFS
Btrfs
ZFS
Device Mapper
4. Capabilities（能力）
Linux 内核的 capabilities 是对 root 用户权限进行细分的机制，允许管理员仅授予进程特定的权限。Docker 通过设置容器的能力，可以限制容器对宿主机资源的访问权限，从而实现安全隔离。例如，Docker 容器默认只授予容器所需的最低权限，防止容器中运行的应用有不必要的特权。

5. SELinux / AppArmor（安全模块）
Docker 支持 SELinux（Security-Enhanced Linux）和 AppArmor（Application Armor）等安全模块，这些安全策略通过强制访问控制（MAC）限制容器对系统资源的访问，进一步增强了容器的隔离性和安全性。这些模块可以确保容器无法访问宿主机上不允许的资源和数据。
```

#### docker的写时复制

```
写时复制（Copy-on-Write, COW） 是 Docker 使用的一种高效的文件系统技术，特别是在容器化应用中，写时复制能有效地提高存储效率并减少资源浪费。它使得容器在创建和修改文件时，能够以最低的成本实现文件共享和修改。Docker 实现写时复制的关键技术是在其底层的文件系统（如 Union File System (UnionFS)）中使用的。

写时复制的工作原理
在 Docker 中，镜像和容器文件系统都是基于 Union File System 的，UnionFS 允许将多个文件系统层叠起来，每个层代表一个只读的文件系统（例如镜像中的层），而容器则是基于这些层叠加上一个可写的层。写时复制技术的核心思想是：

共享只读层：当你从一个 Docker 镜像创建一个容器时，Docker 并不会复制整个镜像文件系统，而是将镜像的各个层以只读方式共享给容器使用。

创建可写层：当容器运行时，它会在镜像的各个只读层之上创建一个 可写层。容器对文件系统的修改（如创建新文件、修改文件、删除文件等）不会直接改变原始镜像的内容，而是写入到这个新的可写层中。

写时复制：当容器试图修改一个文件时，Docker 会先检查该文件是否存在于镜像的只读层中。如果文件存在，它不会直接修改原始文件，而是复制一份文件到可写层中，然后对其进行修改。这样，容器和镜像之间的文件操作就实现了“写时复制”，即只有在需要修改文件时才复制文件。
```

https://github.com/apachecn/baguwen-wiki/blob/master/docs/Docker-%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E7%88%AA%E5%93%87%E7%A8%8B%E5%BA%8F%E5%91%98%EF%BC%89.md

https://learnku.com/server/t/42179

[96道Docker面试八股文（答案、分析和深入提问）整理_docker面试题-CSDN博客](https://blog.csdn.net/ocean2103/article/details/142679023)